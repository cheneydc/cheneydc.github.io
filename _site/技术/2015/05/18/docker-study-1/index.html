<!DOCTYPE html>
<html>

    <head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>docker学习（1）</title>
<meta name="description" content="随便写点">

<link rel="profile" href="http://gmpg.org/xfn/11" />
<link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css">
<link rel="stylesheet" href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css">
<link rel="stylesheet" type="text/css" media="all" href="/css/style.css" />
<link rel="stylesheet" type="text/css" media="all" href="/css/jquery.mmenu.all.css" />
<link rel="stylesheet" href="/css/highlightjs.piperita.css">

<!-- Favicons generated at http://realfavicongenerator.net/ -->
<link rel="apple-touch-icon" sizes="57x57" href="/favicons/apple-touch-icon-57x57.png">
<link rel="apple-touch-icon" sizes="60x60" href="/favicons/apple-touch-icon-60x60.png">
<link rel="apple-touch-icon" sizes="72x72" href="/favicons/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="76x76" href="/favicons/apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" sizes="114x114" href="/favicons/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="120x120" href="/favicons/apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" sizes="144x144" href="/favicons/apple-touch-icon-144x144.png">
<link rel="apple-touch-icon" sizes="152x152" href="/favicons/apple-touch-icon-152x152.png">
<link rel="apple-touch-icon" sizes="180x180" href="/favicons/apple-touch-icon-180x180.png">
<link rel="icon" type="image/png" href="/favicons/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/favicons/android-chrome-192x192.png" sizes="192x192">
<link rel="icon" type="image/png" href="/favicons/favicon-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="/favicons/favicon-16x16.png" sizes="16x16">
<link rel="manifest" href="/favicons/manifest.json">
<link rel="shortcut icon" href="/favicons/favicon.ico">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="msapplication-TileImage" content="/favicons/mstile-144x144.png">
<meta name="msapplication-config" content="/favicons/browserconfig.xml">
<meta name="theme-color" content="#ffffff">


</head>


    <body>

    <nav id="my-menu">
  <div>
    <p>大葱</p>

    <ul class="pages">
      <li><a href="/"><i class="fa fa-home"></i> Home</a></li>
      <li><a href="/posts/"><i class="fa fa-archive"></i> All Posts</a></li>
      <li><a href="/search/"><i class="fa fa-search"></i> Search</a></li>
    </ul>

    <p class="links">
  
  
  
  <a href="https://github.com/cheneydc" target="_new"><i class="fa fa-github-alt"></i></a>
  
  <a href="/feed.xml" target="_new"><i class="fa fa-rss"></i></a>
</p>

  </div>
</nav>
<div class="menu-button" href="#menu"><i class="fa fa-bars"></i></div>


    <div class="page-content">
      <div class="wrap">
      

<div class="container-fluid single">
  <div class="row">

    <div itemscope itemtype="http://schema.org/Article" class="col-md-12 article">
      

      <h1 class="header" itemprop="name">docker学习（1）</h1>

      <div class="author">
        <small><i>
          
          on <span itemprop="datePublished" content="2014-08-28">May 18, 2015</span>
           under 技术
        </i></small>
      </div>

      <div class="read-time">
        <small>
          2 minute read
        </small>
      </div>

      <div class="content-panel content">
        <span itemprop="articleBody"><p>###1. Docker 简介 <em>《The Docker Book》</em><br />Docker 是一个能够把开发的应用程序自动部署到容器的开源引擎。由 Docker 公司的团队编写。Docker在虚拟化的容器执行环境中增加了一个应用程序部署引擎。该引擎的目标就是提供一个轻量、快速的环境，能够运行开发者的程序，并方便高效地将程序从开发者的电脑部署到测试环境，然后再部署到生产环境。Docker上手非常快，用户只需要几分钟，就可以把自己的程序”Docker”化。</p>

<p>开发人员关心容器中的应用程序，而运维只需要考虑如何管理docker。</p>

<hr />

<p>###2. Docker组件<br />
- Docker Server/Client<br />
- Docker image<br />
- Registry<br />
- Docker Containers</p>

<h1 id="docker-serverclient">2.1. Docker Server/Client</h1>
<p>Docker是一个C/S架构的程序。Client只向Server或者守护进程发出请求，Server或者守护进程完成工作并返回结果。</p>

<h1 id="docker-image">2.2. Docker Image</h1>
<p>Image 是构建Docker的基础。用户基于Image来运行自己的容器。Image也是Docker生命周期的”构建”部分。Image是基于联合文件系统的一种层式的结构，由一系列的指令一步一步构建出来的。例如：<br />
- 添加一个文件<br />
- 执行一个命令<br />
- 打开一个终端</p>

<p>可以把Image当作容器的”源代码”。</p>

<blockquote>
  <p>这部分不是很理解，感觉像一个安装脚本，最后执行产生的结果是所需要的，后面操作慢慢看…</p>
</blockquote>

<h1 id="docker-registry">2.3. Docker Registry</h1>
<p>Docker 用 Registry 来保存用户构建的Image。Registry分为公有（Docker Hub）和私有两种。</p>

<blockquote>
  <p>应该和git仓库比较像</p>
</blockquote>

<h1 id="docker-containers">2.4. Docker containers</h1>
<p>Docker 可以帮你构建和部署容器，你只需要把自己的应用程序或者服务打包放进容器。刚刚提到，容器是基于Image启动的，容器中可以运行一个或者多个进程。Image相当于Docker生命周期的构建或者打包阶段，Containers相当于启动或者执行阶段。</p>

<p>总结起来，Docker container就是：<br />
- 一个镜像格式<br />
- 一系列标准的操作<br />
- 一个执行环境</p>

<p>Docker借鉴了标准集装箱的概念。标准集装箱将货物运往世界各地，Docker将这个模型运用到设计哲学中，不同的是，集装箱运输货物，Docker运输软件。</p>

<p>和集装箱一样，Docker在执行操作的时候，不关心容器中的是什么，是数据库还是web服务器，还是别的应用程序。所有的容器都按照相同的方式将内容”装载”进去。</p>

<hr />

<h2 id="docker-">3. Docker 的技术组件</h2>
<p>Docker 可以运行于任何安装了现代Linux内核的x64主机上。Docker开销较低，主要包括一下几个部分：</p>

<p>一个原生的Linux容器格式，Docker中成为<strong><em>libcontainer</em></strong>，或者很流行的容器平台<strong><em><a href="http://lxc.sourceforge.net">lxc</a></em></strong>。libcontainer格式现在是Docker容器的默认格式。<br />
- 文件系统隔离： 每个容器都有自己的root文件系统<br />
- 进程隔离： 每个容器都运行在自己的进程环境中<br />
- 网络隔离： 容器间的虚拟网络接口和IP地址是分开的<br />
- 资源隔离和分组： 使用<strong><em><a href="http://en.wikipedia.org/wiki/Cgroups">cgroups</a></em></strong>将CPU和内存之类的资源独立分配给每个Docker容器<br />
- <strong><em><a href="http://en.wikipedia.org/wiki/Copy-on-write">写时复制</a></em></strong>： 文件系统都是通过写时复制创建的，这就意味着文件系统是分层的、快速的，而且占用的磁盘空间更小<br />
- 日志： 容器产生的STUOUT、STDERR和STDIN这些IO流都会被收集并入日志，用来进行日志分析和故障排错<br />
- 交互式shell： 用户可以创建一个伪tty终端，将其连接到STDIN，为容器提供一个交互式的shell</p>

<hr />

<h2 id="docker">4. 安装Docker</h2>
<p>先决条件：  <br />
- 64位<br />
- 3.8版本以上的kernel，2.6.x也能运行，但是有很大不同<br />
- 内核必须支持一种适合的存储驱动，例如：<br />
  - <a href="http://en.wikipedia.org/wiki/Device_manager">Device manager</a><br />
  - <a href="http://en.wikipedia.org/wiki/Aufs">AUFS</a><br />
  - <a href="http://en.wikipedia.org/wiki/Virtual_file_system">vfs</a><br />
  - <a href="http://en.wikipedia.org/wiki/Btrfs">btrfs</a><br />
  - 默认通常是Device Mapper</p>

<ul>
  <li>kernel支持并开启cgroups和namespace功能</li>
</ul>

<blockquote>
  <p><em>环境</em> Ubuntu 14.10 amd64</p>
</blockquote>

<h3 id="section">4.1. 检查环境</h3>
<ul>
  <li>检查内核</li>
</ul>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>uname -a</code></pre></div>

<ul>
  <li>检查是否安装Device Mapper</li>
  <li></li>
</ul>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">- <span class="nv">$ </span>ls -l /sys/class/misc/device-mapper
- lrwxrwxrwx <span class="m">1</span> root root <span class="m">0</span>  5月 <span class="m">18</span> 20:26 /sys/class/misc/device-mapper -&gt; ../../devices/virtual/misc/device-mapper
-</code></pre></div>

<p>也可以</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>sudo grep device-mapper /proc/devices</code></pre></div>

<p>如果没有出现相关信息，可以尝试加载dm_mod模块</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>sudo modprobe dm_mod</code></pre></div>

<ul>
  <li>cgroup 和 namespace 从2.6以后的版本就集成在kernel了</li>
</ul>

<h3 id="section-1">4.2. 安装</h3>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>sh -c <span class="s2">&quot;echo deb [https://get.docker.io/ubuntu](https://get.docker.io/ubuntu) docker main &gt; /etc/apt/sources.list.d/docker.list&quot;</span> <span class="nv">$ </span>curl -s <span class="o">[</span>https://get.docker.io/gpg<span class="o">](</span>https://get.docker.io/gpg<span class="o">)</span> <span class="p">|</span> sudo apt-key add - <span class="nv">$ </span>sudo apt-get update <span class="nv">$ </span>sudo apt-get install lxc-docker <span class="nv">$ </span>sudo docker info Containers: <span class="m">0</span> Images: <span class="m">2</span> Storage Driver: aufs  Root Dir: /var/lib/docker/aufs  Backing Filesystem: extfs  Dirs: <span class="m">2</span>  Dirperm1 Supported: <span class="nb">true </span>Execution Driver: native-0.2 Kernel Version: 3.16.0-37-generic Operating System: Ubuntu Kylin 14.10 CPUs: <span class="m">4</span> Total Memory: 5.63 GiB Name: codong ID: WTRJ:5GFG:QWBJ:VKF2:KB4S:UQAE:UGPS:YDIR:L6DI:DRAE:BTRU:AMVG WARNING: No swap limit support</code></pre></div>

<p>如果使用ufw，需要更改其策略，默认ufw会丢弃所有转发的数据包。</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>vim /etc/default/ufw</code></pre></div>

<p>将<br /></p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">DEFAULT_FORWARD_POLICY</span><span class="o">=</span><span class="s1">&#39;DROP&#39;</span></code></pre></div>

<p>替换成</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">DEFAULT_FORWARD_POLICY</span><span class="o">=</span><span class="s1">&#39;ACCEPT&#39;</span></code></pre></div>

<p>重新加载UFW<br /></p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>sudo ufw reload</code></pre></div>

</span>

        

        

      </div>

      <div class="content-panel feedback">
        I <i class="fa fa-heart"></i> feedback.<br />
        Let me know what you think of this article on twitter <a href="http://www.twitter.com/">@</a> or leave a comment below!
      </div>

      
      <div class="content-panel comments">
        <div id="disqus_thread">
          <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
          <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
        </div>
      </div>
      

      

    </div>

  </div>

</div>


<script type="text/javascript">
/* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
function disqus_config() { this.experiment.enable_scroll_container = true; }
var disqus_shortname = "cheneydc"; // required: replace example with your forum shortname
/* * * DON'T EDIT BELOW THIS LINE * * */
(function() {
  var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>


      </div>
    </div>

    <div class="footer clearfix">
  <div class="col-md-6">
    Made with <i class="fa fa-heart"></i> by <a href="https://twitter.com/_JacobTomlinson">Jacob Tomlinson</a>
  </div>
  <div class="col-md-6">
    &lt;/&gt; on <a href="https://github.com/jacobtomlinson/carte-noire">Github</a> &nbsp;<i class="fa fa-github-alt"></i>
  </div>
</div>

<script src="//code.jquery.com/jquery-1.11.0.min.js"></script>
<script src="//netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>
<script src="/js/jquery.mmenu.min.all.js"></script>
<script src="http://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.7/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
<script type="text/javascript">
   $(document).ready(function() {
      $("#my-menu").mmenu().on( "closed.mm", function() {
            $(".menu-button").show();
         });
      $(".menu-button").click(function() {
        $(".menu-button").hide();
        $("#my-menu").trigger("open.mm");
      });
   });
</script>


<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-70353781-1']);
          _gaq.push(['_trackPageview']);
  (function () {
      var ga = document.createElement('script');
      ga.type = 'text/javascript';
      ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';

      var s = document.getElementsByTagName('script')[0];
      s.parentNode.insertBefore(ga, s);
  })();
</script>



    </body>
</html>
